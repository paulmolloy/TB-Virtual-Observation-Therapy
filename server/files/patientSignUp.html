<!--<color name="colorPrimary">#008577</color>
    <color name="colorPrimaryDark">#00574B</color>
    <color name="colorAccent">#D81B60</color>      -->

<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script
  src="http://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous">
  </script>

  <script type="text/javascript">
    var fields = [0];
  </script>

    <title>Patient sign up form</title>
    <style>
      @font-face {
        font-family: roboto;
        src: url(Roboto-Regular.ttf);
      }
      html {
        min-height: 100%;
      }
      #signup{
            margin-top: 40px;
            width:350px;
            background-color: #F0EEEE;
            padding: 30px;
            border-radius: 15px;
            height:400px;
            text-align: left;
            margin-left: auto;
            margin-right: auto;
          }
      body{
        background: -webkit-linear-gradient(#008577, #80fff2);
        background: -o-linear-gradient(#008577, #80fff2);
        background: -moz-linear-gradient(#008577, #80fff2);
        background: linear-gradient(#008577, #80fff2);
        background-color: #93B874;
        font-family: roboto;
        margin: 0 auto;
      }
      #button{
        float:right;
      }
      #patientname{
        width:100%;
      }
      #nurseid
      {
        width:100%;
      }
      #password
      {
        width:100%;
      }
      #email
      {
        width:100%;
      }
      h1{
        text-align:center;
        margin-top:40px;
      }
      label{
        display: inline-block;
        float: left;
        clear: left;
        width: 100px;
        text-align: left;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase-functions.js"></script>
    <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyAgQbVptjsQH0p-4YgJtaCWIQtXaS_SyhE",
      authDomain: "tb-vot.firebaseapp.com",
      databaseURL: "https://tb-vot.firebaseio.com",
      projectId: "tb-vot",
      storageBucket: "tb-vot.appspot.com",
      messagingSenderId: "80680232908"
    };
    firebase.initializeApp(config);
    </script>
</head>
</head>

<body>
  <h1><font size=5 color=#ffffff >Patient Sign up Form</font></h1>
  <div id="signup">
  <form action="/patientSignedUp" method="post">
    <div class="form-group" >
          <label for="patientname">Patient name:</label></font>
          <input type="text" id="patientname" name="patient_name">
        </div>
        <div class="form-group" >
          <label for="email">E-mail:</label></font>
          <input type="email" id="email" name="patient_mail">
        </div>
        <div class="form-group" >
          <label for="password">Password:</label></font>
          <input type="password" id="password" name="patient_password">
        </div>
        <div class="form-group" >
          <label for="nurseid">Nurse ID:</label></font>
          <input type="text" id="nurseid" name="nurse_id">
        </div>
        <div class="form-group" >
          <label for="authtoken">Auth Token:</label></font>
          <input type="text" id="authtoken" name="auth_token">
        </div>
        <div class="button">
          <input type="button" id="button" class="btn btn-primary" name="signup" value="Sign Up" onclick= "getValues()" >
        </div>
        <p id="message" ></p>
    </form>
  </div>
</body>

<script type="text/javascript">

  function setMessage(message){
      document.getElementById("message").textContent = message
  }

  function redirect(){
      setMessage("Redirecting... ")
      window.location.replace("/graph")
  }

  function getValues()
  {
    firebase.auth().currentUser.getIdToken().then(authToken => {

      var patientname = document.getElementById('patientname').value;
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      var nurseID = firebase.auth().currentUser.uid;

      var upload = { name: patientname, email, password, nurseID, authToken }

      $.ajax({
            type: "POST",
            url: "/api/patients",
            contentType: "application/json",
            data: JSON.stringify(upload),
            success: function (msg)
            {
                var patientID = msg.data.uid

                firebase.firestore().doc("patients/" + patientID).set
                (
                  {
                    streak: 0,
                    takenToday: false,
                    timeToTake: "14:00"
                  },
                  { merge: true }
                )
            }
          });
    })
  }
</script>

</html>
